[{"kind":1,"language":"markdown","value":"# Conversion Funnel 101\nThe EASIEST Way to Build and Visualise a Conversion Funnel\n\n\n### What is a Conversion Funnel?\n<img src=\"../../images/funnel101/funnel.png\" alt=\"by DAN LEBLANC\" width=\"500\"/>\n\nA conversion funnel, also referred to as a site funnel, is the path to purchase in an eCommerce store or site. In some ways, it can be compared to the traditional marketing funnel, but different than a traditional funnel, most of the steps are occurring on your site. （by Dan LeBlanc）\n\n### You can Do More with Less in Byzer !\nWithout further ado, let's get started.","outputs":[]},{"kind":1,"language":"markdown","value":"### Use Case\nWe will use [this e-commerce website dataset](https://www.kaggle.com/aerodinamicc/ecommerce-website-funnel-analysis) throughout this tutorial. You can find the data under sample_data/funnel_analysis folder.\n\nThe site is very simple and has just 4 pages:\nThe first page is the home page. When you come to the site for the first time, you can only land on the home page as a first page.\n\nFrom the home page, the user can perform a search and land on the search page.\n\nFrom the search page, if the user clicks on a product, she will get to the payment page, where she is asked to provide payment information in order to buy that product.\nIf she does decide to buy, she ends up on the confirmation page.\n\nThe company CEO isn't very happy with the volume of sales and, especially, of sales coming from new users. Therefore, she asked you to investigate whether there is something wrong in the conversion funnel or, in general, if you could suggest how conversion rate can be improved.\n\n### Step 0: Start Ray runtime","outputs":[]},{"kind":1,"language":"markdown","value":"conda activate dev\n\nray start --head","outputs":[]},{"kind":1,"language":"markdown","value":"### Step 1: Load CSV files into Byzer Engine\nLet's create a micro called loadCSV.\n\nMacro are pieces of code that can be reused multiple times - they are analogous to \"functions\" in other programming languages, and are extremely useful if you find yourself repeating code across multiple places.\n\nIn this case, there are five files to be loaded. To make our life easier, we'll create a micro called loadCSV and then call this micro to load all files separately.","outputs":[]},{"kind":2,"language":"mlsql","value":"--create a micro called loadCSV \nset loadCSV = '''\nload csv.`./sample_data/funnel_analysis/{0}.csv`\nwhere header=\"true\"\nas {1}\n''';\n--load each CSV file into Byzer engine as a table object\n!loadCSV home_page_table home_page;\n!loadCSV payment_confirmation_table payment_confirmation;\n!loadCSV payment_page_table payment_page;\n!loadCSV search_page_table search_page;\n!loadCSV user_table user;","outputs":[{"mime":"x-application/mlsql-notebook","value":"{\n\t\"schema\": {\n\t\t\"type\": \"struct\",\n\t\t\"fields\": [\n\t\t\t{\n\t\t\t\t\"name\": \"user_id\",\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"date\",\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"device\",\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"sex\",\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t}\n\t\t]\n\t},\n\t\"data\": [\n\t\t{\n\t\t\t\"user_id\": \"450007\",\n\t\t\t\"date\": \"2015-02-28\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"756838\",\n\t\t\t\"date\": \"2015-01-13\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"568983\",\n\t\t\t\"date\": \"2015-04-09\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"190794\",\n\t\t\t\"date\": \"2015-02-18\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"537909\",\n\t\t\t\"date\": \"2015-01-15\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"993454\",\n\t\t\t\"date\": \"2015-03-03\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"377150\",\n\t\t\t\"date\": \"2015-04-15\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"137258\",\n\t\t\t\"date\": \"2015-01-27\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"608249\",\n\t\t\t\"date\": \"2015-04-12\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"615615\",\n\t\t\t\"date\": \"2015-02-24\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"96069\",\n\t\t\t\"date\": \"2015-04-13\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"664476\",\n\t\t\t\"date\": \"2015-02-13\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"236201\",\n\t\t\t\"date\": \"2015-03-14\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"796359\",\n\t\t\t\"date\": \"2015-04-02\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"592962\",\n\t\t\t\"date\": \"2015-04-25\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"971488\",\n\t\t\t\"date\": \"2015-02-27\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"610157\",\n\t\t\t\"date\": \"2015-02-11\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"561375\",\n\t\t\t\"date\": \"2015-04-11\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"624556\",\n\t\t\t\"date\": \"2015-01-25\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"443293\",\n\t\t\t\"date\": \"2015-03-19\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"435414\",\n\t\t\t\"date\": \"2015-03-11\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"969529\",\n\t\t\t\"date\": \"2015-04-14\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"830503\",\n\t\t\t\"date\": \"2015-01-21\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"184748\",\n\t\t\t\"date\": \"2015-02-18\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"68397\",\n\t\t\t\"date\": \"2015-04-02\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"682442\",\n\t\t\t\"date\": \"2015-04-03\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"62655\",\n\t\t\t\"date\": \"2015-01-30\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"159517\",\n\t\t\t\"date\": \"2015-03-25\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"78294\",\n\t\t\t\"date\": \"2015-04-19\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"504960\",\n\t\t\t\"date\": \"2015-03-08\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"449259\",\n\t\t\t\"date\": \"2015-02-15\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"976991\",\n\t\t\t\"date\": \"2015-04-24\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"639988\",\n\t\t\t\"date\": \"2015-04-03\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"668253\",\n\t\t\t\"date\": \"2015-02-05\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"838832\",\n\t\t\t\"date\": \"2015-03-08\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"126297\",\n\t\t\t\"date\": \"2015-01-01\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"700880\",\n\t\t\t\"date\": \"2015-01-07\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"606959\",\n\t\t\t\"date\": \"2015-02-21\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"252135\",\n\t\t\t\"date\": \"2015-03-10\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"886066\",\n\t\t\t\"date\": \"2015-01-10\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"283193\",\n\t\t\t\"date\": \"2015-02-12\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"527765\",\n\t\t\t\"date\": \"2015-03-13\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"265629\",\n\t\t\t\"date\": \"2015-04-27\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"469531\",\n\t\t\t\"date\": \"2015-04-20\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"632470\",\n\t\t\t\"date\": \"2015-03-06\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"142395\",\n\t\t\t\"date\": \"2015-02-21\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"948203\",\n\t\t\t\"date\": \"2015-03-03\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"601434\",\n\t\t\t\"date\": \"2015-02-03\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"429473\",\n\t\t\t\"date\": \"2015-02-28\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"291813\",\n\t\t\t\"date\": \"2015-03-28\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"378948\",\n\t\t\t\"date\": \"2015-03-06\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"220197\",\n\t\t\t\"date\": \"2015-01-14\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"245517\",\n\t\t\t\"date\": \"2015-02-23\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"594992\",\n\t\t\t\"date\": \"2015-04-18\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"231324\",\n\t\t\t\"date\": \"2015-02-22\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"107605\",\n\t\t\t\"date\": \"2015-03-04\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"870834\",\n\t\t\t\"date\": \"2015-02-11\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"604565\",\n\t\t\t\"date\": \"2015-04-03\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"984873\",\n\t\t\t\"date\": \"2015-04-04\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"623145\",\n\t\t\t\"date\": \"2015-04-04\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"457209\",\n\t\t\t\"date\": \"2015-01-07\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"13830\",\n\t\t\t\"date\": \"2015-02-05\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"716584\",\n\t\t\t\"date\": \"2015-03-15\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"434895\",\n\t\t\t\"date\": \"2015-01-07\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"471874\",\n\t\t\t\"date\": \"2015-02-17\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"838723\",\n\t\t\t\"date\": \"2015-02-19\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"731725\",\n\t\t\t\"date\": \"2015-03-26\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"25566\",\n\t\t\t\"date\": \"2015-04-12\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"566349\",\n\t\t\t\"date\": \"2015-02-27\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"880532\",\n\t\t\t\"date\": \"2015-04-10\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"574808\",\n\t\t\t\"date\": \"2015-02-19\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"418014\",\n\t\t\t\"date\": \"2015-02-22\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"205344\",\n\t\t\t\"date\": \"2015-01-27\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"176571\",\n\t\t\t\"date\": \"2015-01-03\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"41600\",\n\t\t\t\"date\": \"2015-02-21\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"727796\",\n\t\t\t\"date\": \"2015-03-26\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"167038\",\n\t\t\t\"date\": \"2015-04-13\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"94187\",\n\t\t\t\"date\": \"2015-04-30\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"985123\",\n\t\t\t\"date\": \"2015-04-13\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"965822\",\n\t\t\t\"date\": \"2015-02-19\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"999441\",\n\t\t\t\"date\": \"2015-02-06\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"872473\",\n\t\t\t\"date\": \"2015-01-26\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"476955\",\n\t\t\t\"date\": \"2015-03-23\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"384199\",\n\t\t\t\"date\": \"2015-03-24\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"388103\",\n\t\t\t\"date\": \"2015-03-30\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"407805\",\n\t\t\t\"date\": \"2015-03-18\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"779585\",\n\t\t\t\"date\": \"2015-02-08\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"958443\",\n\t\t\t\"date\": \"2015-01-31\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"846115\",\n\t\t\t\"date\": \"2015-03-12\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"647067\",\n\t\t\t\"date\": \"2015-03-05\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"210950\",\n\t\t\t\"date\": \"2015-01-15\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"178373\",\n\t\t\t\"date\": \"2015-04-30\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"67626\",\n\t\t\t\"date\": \"2015-03-22\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"355552\",\n\t\t\t\"date\": \"2015-03-22\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"795169\",\n\t\t\t\"date\": \"2015-03-26\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"552008\",\n\t\t\t\"date\": \"2015-04-19\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"874797\",\n\t\t\t\"date\": \"2015-01-26\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"336186\",\n\t\t\t\"date\": \"2015-02-20\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"449714\",\n\t\t\t\"date\": \"2015-01-28\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"635882\",\n\t\t\t\"date\": \"2015-02-22\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"648838\",\n\t\t\t\"date\": \"2015-02-27\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"920130\",\n\t\t\t\"date\": \"2015-04-03\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"853085\",\n\t\t\t\"date\": \"2015-01-09\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"141250\",\n\t\t\t\"date\": \"2015-03-20\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"155756\",\n\t\t\t\"date\": \"2015-01-14\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"435742\",\n\t\t\t\"date\": \"2015-02-01\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"179518\",\n\t\t\t\"date\": \"2015-01-05\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"83581\",\n\t\t\t\"date\": \"2015-01-30\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"801991\",\n\t\t\t\"date\": \"2015-01-04\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"637254\",\n\t\t\t\"date\": \"2015-01-09\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"324784\",\n\t\t\t\"date\": \"2015-04-04\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"587563\",\n\t\t\t\"date\": \"2015-01-17\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"797730\",\n\t\t\t\"date\": \"2015-03-20\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"239133\",\n\t\t\t\"date\": \"2015-04-24\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"821176\",\n\t\t\t\"date\": \"2015-01-30\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"193027\",\n\t\t\t\"date\": \"2015-04-03\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"524052\",\n\t\t\t\"date\": \"2015-03-12\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"782646\",\n\t\t\t\"date\": \"2015-04-06\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"707617\",\n\t\t\t\"date\": \"2015-02-20\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"26481\",\n\t\t\t\"date\": \"2015-03-14\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"263024\",\n\t\t\t\"date\": \"2015-04-27\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"468189\",\n\t\t\t\"date\": \"2015-01-01\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"424187\",\n\t\t\t\"date\": \"2015-01-13\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"697998\",\n\t\t\t\"date\": \"2015-01-13\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"226861\",\n\t\t\t\"date\": \"2015-02-08\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"106038\",\n\t\t\t\"date\": \"2015-01-07\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"140864\",\n\t\t\t\"date\": \"2015-01-19\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"996089\",\n\t\t\t\"date\": \"2015-03-16\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"581208\",\n\t\t\t\"date\": \"2015-01-02\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"592297\",\n\t\t\t\"date\": \"2015-04-26\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"88600\",\n\t\t\t\"date\": \"2015-04-19\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"428198\",\n\t\t\t\"date\": \"2015-02-23\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"671415\",\n\t\t\t\"date\": \"2015-03-21\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"970783\",\n\t\t\t\"date\": \"2015-03-27\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"212557\",\n\t\t\t\"date\": \"2015-04-19\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"681538\",\n\t\t\t\"date\": \"2015-02-08\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"717441\",\n\t\t\t\"date\": \"2015-01-30\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"112814\",\n\t\t\t\"date\": \"2015-04-09\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"95108\",\n\t\t\t\"date\": \"2015-01-29\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"158455\",\n\t\t\t\"date\": \"2015-04-25\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"294234\",\n\t\t\t\"date\": \"2015-03-16\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"251157\",\n\t\t\t\"date\": \"2015-03-10\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"947971\",\n\t\t\t\"date\": \"2015-03-08\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"26348\",\n\t\t\t\"date\": \"2015-01-27\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"931071\",\n\t\t\t\"date\": \"2015-03-16\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"416753\",\n\t\t\t\"date\": \"2015-03-03\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"560881\",\n\t\t\t\"date\": \"2015-03-06\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"914566\",\n\t\t\t\"date\": \"2015-04-01\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"624314\",\n\t\t\t\"date\": \"2015-04-07\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"261175\",\n\t\t\t\"date\": \"2015-04-18\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"469756\",\n\t\t\t\"date\": \"2015-01-24\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"325655\",\n\t\t\t\"date\": \"2015-02-19\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"780988\",\n\t\t\t\"date\": \"2015-04-03\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"873311\",\n\t\t\t\"date\": \"2015-01-19\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"485948\",\n\t\t\t\"date\": \"2015-03-03\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"846486\",\n\t\t\t\"date\": \"2015-02-04\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"759991\",\n\t\t\t\"date\": \"2015-02-10\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"260665\",\n\t\t\t\"date\": \"2015-04-02\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"137037\",\n\t\t\t\"date\": \"2015-04-11\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"481376\",\n\t\t\t\"date\": \"2015-03-29\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"126569\",\n\t\t\t\"date\": \"2015-02-24\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"579677\",\n\t\t\t\"date\": \"2015-03-26\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"957293\",\n\t\t\t\"date\": \"2015-04-16\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"430295\",\n\t\t\t\"date\": \"2015-01-21\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"569491\",\n\t\t\t\"date\": \"2015-03-29\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"422726\",\n\t\t\t\"date\": \"2015-01-10\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"723540\",\n\t\t\t\"date\": \"2015-04-29\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"521442\",\n\t\t\t\"date\": \"2015-02-01\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"362111\",\n\t\t\t\"date\": \"2015-04-01\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"17329\",\n\t\t\t\"date\": \"2015-04-02\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"628199\",\n\t\t\t\"date\": \"2015-04-02\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"862101\",\n\t\t\t\"date\": \"2015-03-21\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"711742\",\n\t\t\t\"date\": \"2015-03-17\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"792150\",\n\t\t\t\"date\": \"2015-04-18\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"52348\",\n\t\t\t\"date\": \"2015-02-20\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"174311\",\n\t\t\t\"date\": \"2015-03-27\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"218289\",\n\t\t\t\"date\": \"2015-02-26\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"892708\",\n\t\t\t\"date\": \"2015-02-27\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"926378\",\n\t\t\t\"date\": \"2015-04-05\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"154247\",\n\t\t\t\"date\": \"2015-03-01\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"618376\",\n\t\t\t\"date\": \"2015-01-14\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"153398\",\n\t\t\t\"date\": \"2015-03-20\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"211834\",\n\t\t\t\"date\": \"2015-02-23\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"807280\",\n\t\t\t\"date\": \"2015-04-17\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"541702\",\n\t\t\t\"date\": \"2015-03-07\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"812904\",\n\t\t\t\"date\": \"2015-04-25\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"800490\",\n\t\t\t\"date\": \"2015-02-27\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"91251\",\n\t\t\t\"date\": \"2015-04-19\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"725835\",\n\t\t\t\"date\": \"2015-04-18\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"80921\",\n\t\t\t\"date\": \"2015-01-21\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"423478\",\n\t\t\t\"date\": \"2015-03-03\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"145498\",\n\t\t\t\"date\": \"2015-01-28\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"124672\",\n\t\t\t\"date\": \"2015-04-10\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"291840\",\n\t\t\t\"date\": \"2015-03-05\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Female\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"79105\",\n\t\t\t\"date\": \"2015-02-17\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"643460\",\n\t\t\t\"date\": \"2015-04-21\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"89968\",\n\t\t\t\"date\": \"2015-04-13\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"367090\",\n\t\t\t\"date\": \"2015-01-12\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"323678\",\n\t\t\t\"date\": \"2015-04-03\",\n\t\t\t\"device\": \"Desktop\",\n\t\t\t\"sex\": \"Male\"\n\t\t},\n\t\t{\n\t\t\t\"user_id\": \"949671\",\n\t\t\t\"date\": \"2015-02-25\",\n\t\t\t\"device\": \"Mobile\",\n\t\t\t\"sex\": \"Male\"\n\t\t}\n\t]\n}"}]},{"kind":1,"language":"markdown","value":"Now is the time to introduce Byzer's core concept - Everything is a table.\n\nOnce the data is loaded into Byzer engine, you can see them as a flat table and access and manipulate data by thinking in SQL.\n\n### Step 2: SQL Time","outputs":[]},{"kind":2,"language":"mlsql","value":"-- Step 1: join event data with user data\nselect user.*,\ncase when home_page.page = 'home_page' then 1 else 0 end as step1,\ncase when search_page.page = 'search_page' then 1 else 0 end as step2,\ncase when payment_page.page = 'payment_page' then 1 else 0 end as step3,\ncase when payment_confirmation.page = 'payment_confirmation_page' then 1 else 0 end as step4\nfrom user left join home_page\non user.user_id = home_page.user_id\nleft join search_page\non user.user_id = search_page.user_id\nleft join payment_page\non user.user_id = payment_page.user_id\nleft join payment_confirmation\non user.user_id = payment_confirmation.user_id\nas user_events;\n\n-- Step 2: Calculate the user count for each stage of the funnel\nselect\n\"step\" as step,\nsum(step1) as step1_visitors,\nsum(step2) as step2_product_search,\nsum(step3) as step3_willing_to_pay,\nsum(step4) as step4_pay\nfrom user_events\nas user_events_summary;","outputs":[{"mime":"x-application/mlsql-notebook","value":"{\n\t\"schema\": {\n\t\t\"type\": \"struct\",\n\t\t\"fields\": [\n\t\t\t{\n\t\t\t\t\"name\": \"step\",\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"nullable\": false,\n\t\t\t\t\"metadata\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"step1_visitors\",\n\t\t\t\t\"type\": \"long\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"step2_product_search\",\n\t\t\t\t\"type\": \"long\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"step3_willing_to_pay\",\n\t\t\t\t\"type\": \"long\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"step4_pay\",\n\t\t\t\t\"type\": \"long\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t}\n\t\t]\n\t},\n\t\"data\": [\n\t\t{\n\t\t\t\"step\": \"step\",\n\t\t\t\"step1_visitors\": 90400,\n\t\t\t\"step2_product_search\": 45200,\n\t\t\t\"step3_willing_to_pay\": 6030,\n\t\t\t\"step4_pay\": 452\n\t\t}\n\t]\n}"}]},{"kind":1,"language":"markdown","value":"#### Step 3: Fun Time - Calculate drop-off at each step\nYou'll likely want to know where the drop-off between steps is the worst. To make it easier to calculate drop-off, you need to transpose columns to rows with Spark SQL stack()function. This function really comes in handy since you don't need write tons of union queries!!! Then you can use the lag() function to compare the output of each step against the one prior and the one after:","outputs":[]},{"kind":2,"language":"mlsql","value":"-- Step 3: Transpose columns to rows with Spark Stack function\nselect\nstack(4,\"step1_visitors\",`step1_visitors`,\n\"step2_product_search\",`step2_product_search`,\n\"step3_willing_to_pay\",`step3_willing_to_pay`,\n\"step4_pay\",`step4_pay`) as (`step`,`unique_user_count`),\nlag(unique_user_count,1) over (order by unique_user_count desc) as previous_step,\nlag(unique_user_count,-1,step4_pay) over (order by unique_user_count desc) as next_step\nfrom user_events_summary\nas pre_funnel;\n\n-- Step 4: Calculate drop-off at each step\nselect *,\nunique_user_count - next_step as drop_off_count,\nround((unique_user_count - previous_step)/previous_step,2) as drop_off\nfrom pre_funnel\nas funnel;","outputs":[{"mime":"x-application/mlsql-notebook","value":"{\n\t\"schema\": {\n\t\t\"type\": \"struct\",\n\t\t\"fields\": [\n\t\t\t{\n\t\t\t\t\"name\": \"step\",\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"unique_user_count\",\n\t\t\t\t\"type\": \"long\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"previous_step\",\n\t\t\t\t\"type\": \"long\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"next_step\",\n\t\t\t\t\"type\": \"long\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"drop_off_count\",\n\t\t\t\t\"type\": \"long\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"drop_off\",\n\t\t\t\t\"type\": \"double\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t}\n\t\t]\n\t},\n\t\"data\": [\n\t\t{\n\t\t\t\"step\": \"step1_visitors\",\n\t\t\t\"unique_user_count\": 90400,\n\t\t\t\"next_step\": 45200,\n\t\t\t\"drop_off_count\": 45200\n\t\t},\n\t\t{\n\t\t\t\"step\": \"step2_product_search\",\n\t\t\t\"unique_user_count\": 45200,\n\t\t\t\"previous_step\": 90400,\n\t\t\t\"next_step\": 6030,\n\t\t\t\"drop_off_count\": 39170,\n\t\t\t\"drop_off\": -0.5\n\t\t},\n\t\t{\n\t\t\t\"step\": \"step3_willing_to_pay\",\n\t\t\t\"unique_user_count\": 6030,\n\t\t\t\"previous_step\": 45200,\n\t\t\t\"next_step\": 452,\n\t\t\t\"drop_off_count\": 5578,\n\t\t\t\"drop_off\": -0.87\n\t\t},\n\t\t{\n\t\t\t\"step\": \"step4_pay\",\n\t\t\t\"unique_user_count\": 452,\n\t\t\t\"previous_step\": 6030,\n\t\t\t\"next_step\": 452,\n\t\t\t\"drop_off_count\": 0,\n\t\t\t\"drop_off\": -0.93\n\t\t}\n\t]\n}"}]},{"kind":1,"language":"markdown","value":"This query suggests we should first focus on the drop-off from Homepage Visit to Product View. The drop-off is substantial and it's near the top of our funnel. Any improvement at the top of the funnel positively impacts all down-funnel metrics.\n\n### Step 4: Funnel visualization with Python in Byzer\n[The plotly Python library](https://medium.com/r/?url=https%3A%2F%2Fplotly.com%2Fpython%2Fis-plotly-free) is an interactive, open-source plotting library that supports over 40 unique chart types covering a wide range of statistical, financial, geographic, scientific, and 3-dimensional use-cases. This package contains everything you need to write figures to standalone HTML files.\n\nLet's check how to draw a funnel chart with Plotly.\n\nFirst things first, let's open up a terminal and install plotly using pip:\n$ pip install plotly==5.6.0","outputs":[]},{"kind":2,"language":"python","value":"#%python\n#%schema=st(field(content,string),field(mime,string))\n#%env=source activate dev\n#%runIn=driver\n#%input=funnel\n\nfrom pyjava.api.mlsql import RayContext,PythonContext\nimport plotly.express as px\nimport pandas as pd\n\ncontext:PythonContext = context\nray_context = RayContext.connect(globals(),None)\n\ndf = ray_context.to_pandas()\nstages = [\"Homepage Visit\", \"Product View\", \"Enter Checkout\", \"Purchase\"]\ndf_nextstep = pd.DataFrame(dict(number=list(df['next_step']), stage=stages))\ndf_nextstep['User Count'] = 'Potential Buyer Count'\ndf_dropoff = pd.DataFrame(dict(number=list(df['drop_off_count']), stage=stages))\ndf_dropoff['User Count'] = 'Drop Off User Count'\ndf = pd.concat([df_nextstep, df_dropoff], axis=0)\nfig = px.funnel(df, x='number', y='stage', color='User Count')\nfig.show()","outputs":[{"mime":"x-application/mlsql-notebook","value":"{\n\t\"schema\": {\n\t\t\"type\": \"struct\",\n\t\t\"fields\": [\n\t\t\t{\n\t\t\t\t\"name\": \"content\",\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"mime\",\n\t\t\t\t\"type\": \"string\",\n\t\t\t\t\"nullable\": true,\n\t\t\t\t\"metadata\": {}\n\t\t\t}\n\t\t]\n\t},\n\t\"data\": []\n}"}]},{"kind":1,"language":"markdown","value":"### Voilà, FUNnel!!!\nYou'll see the funnel in a pop-up window!\n\n<img src=\"../../images/funnel101/1.png\" alt=\"Conversion Funnel\" />","outputs":[]}]